# Moul Copilot

The `copilot` CLI tool is designed to streamline the process of applying Large Language Model (LLM) generated code changes to your local file system. It serves as a practical middle ground between fully autonomous AI agents, which can sometimes feel disconnected from the development workflow, and the manual, error-prone process of copying and pasting code snippets from LLM responses.

This tool helps bridge that gap by:

1.  **Extracting context:** Allowing you to easily gather relevant file contents from your project to provide as context to an LLM.
2.  **Applying changes:** Providing a structured way to apply multi-file changes generated by an LLM (in a specific `.mdiff` format) directly to your project.

This approach aims to keep you in control while leveraging the power of LLMs for code generation and modification.

## Commands

The `copilot` tool provides the following commands:

### 1. `extract`

Extracts content from specified files within a directory, respecting `.gitignore` rules. This is useful for gathering context to feed into an LLM.

**Usage:**

```bash
copilot extract [options] <directory_path> <file_extensions>
```

**Arguments:**

- `<directory_path>`: Path to the directory to scan (e.g., `./src`).
- `<file_extensions>`: Comma-separated list of file extensions to include (e.g., `.go,.md,.js`). Extensions should include the dot.

**Options:**

- `--gitignore <path>`: Path to a custom `.gitignore` file. If not provided, the tool looks for a `.gitignore` file in `<directory_path>`.

**Output Format:**
The `extract` command outputs the content of the matched files to standard output, with each file's content wrapped in tags:

```
<file_path>path/to/relative/file1.ext</file_path>
Content of file1...
<file_path_end>path/to/relative/file1.ext</file_path_end>

<file_path>path/to/another/file2.ext</file_path>
Content of file2...
<file_path_end>path/to/another/file2.ext</file_path_end>
```

**Example:**
To extract all `.go` and `.mod` files from the `./myproject` directory, using the `.gitignore` file located at `./myproject/.gitignore`, and save the output to `context.txt`:

```bash
copilot extract ./myproject .go,.mod > context.txt
```

To use a custom ignore file:

```bash
copilot extract --gitignore ./.custom_ignore ./myproject .ts,.tsx > context.txt
```

### 2. `apply`

Applies file content changes from a specially formatted `.mdiff` file. This command reads the `.mdiff` file, parses file blocks, and writes the specified content to the target files, creating parent directories if they don't exist.

**Usage:**

```bash
copilot apply <mdiff_file>
```

**Arguments:**

- `<mdiff_file>`: Path to the file containing the multi-file diff in the `.mdiff` format.

**`.mdiff` Format:**
The `.mdiff` file must contain one or more blocks, each specifying a file path and its new content. The format for each block is:

```
\n<file_path>path/to/your/file.ext</file_path>\n
The new, complete content for this file.
This content can span multiple lines.
Everything between the start and end file_path tags (exclusive of the tags themselves but inclusive of the newlines around them) is considered the file's content.
\n<file_path_end>path/to/your/file.ext</file_path_end>\n
```

- **Important:**
  - Each block **must** start with `\n<file_path>FILEPATH</file_path>\n` and end with `\n<file_path_end>FILEPATH</file_path_end>\n`.
  - The `FILEPATH` in the start and end tags of a single block must be identical.
  - Paths are typically relative to the current working directory where `copilot apply` is executed.
  - If applying content for multiple files, their blocks are concatenated directly one after another.

**Example `.mdiff` content (`changes.mdiff`):**

```
\n<file_path>src/service/user.go</file_path>\n
package service

// New user service logic
func GetUserName(id int) string {
    return "User " + string(id)
}
\n<file_path_end>src/service/user.go</file_path_end>\n
\n<file_path>README.md</file_path>\n
# Project Alpha

Updated README content.
\n<file_path_end>README.md</file_path_end>\n
```

**Example `apply` command:**
To apply the changes defined in `changes.mdiff` to your project:

```bash
copilot apply ./changes.mdiff
```

This will overwrite `src/service/user.go` and `README.md` with the content specified in `changes.mdiff`. If `src/service/` directory does not exist, it will be created.
